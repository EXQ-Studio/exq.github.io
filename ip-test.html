<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP拦截器测试页面</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 50px;
            min-height: 100vh;
            box-sizing: border-box;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5rem;
        }
        .test-info {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .status {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: bold;
        }
        .status.success {
            background: rgba(76, 175, 80, 0.3);
            border: 1px solid #4CAF50;
        }
        .status.warning {
            background: rgba(255, 193, 7, 0.3);
            border: 1px solid #FFC107;
        }
        .status.error {
            background: rgba(244, 67, 54, 0.3);
            border: 1px solid #f44336;
        }
        .code {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            overflow-x: auto;
        }
        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: all 0.3s ease;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🛡️ IP拦截器测试</h1>
        
        <div class="test-info">
            <h3>当前访问信息</h3>
            <div class="code">
                主机名: <span id="hostname"></span><br>
                协议: <span id="protocol"></span><br>
                完整URL: <span id="fullUrl"></span><br>
                时间: <span id="timestamp"></span>
            </div>
        </div>

        <div id="ipCheck" class="status">
            <h3>🔍 IP检查结果</h3>
            <div id="ipCheckResult">正在检查...</div>
        </div>

        <div id="accessStatus" class="status">
            <h3>🚦 访问状态</h3>
            <div id="accessResult">正在验证...</div>
        </div>

        <div class="test-info">
            <h3>🧪 测试功能</h3>
            <button onclick="testLocalHost()">测试localhost访问</button>
            <button onclick="testServerIP()">测试服务器IP拦截</button>
            <button onclick="testDevMode()">启用开发模式</button>
            <button onclick="clearDevMode()">清除开发模式</button>
        </div>

        <div class="test-info">
            <h3>📋 配置信息</h3>
            <div class="code">
                服务器IP: 47.84.202.74 (应被拦截)<br>
                允许域名: exqstudio.cn, www.exqstudio.cn, exq-studio.github.io<br>
                本地环境: localhost, 127.0.0.1, file://协议
            </div>
        </div>
    </div>

    <!-- 简化版IP拦截器用于测试 -->
    <script>
        // 填充当前访问信息
        document.getElementById('hostname').textContent = window.location.hostname;
        document.getElementById('protocol').textContent = window.location.protocol;
        document.getElementById('fullUrl').textContent = window.location.href;
        document.getElementById('timestamp').textContent = new Date().toLocaleString();

        // IP检查逻辑
        function checkIPStatus() {
            const currentHost = window.location.hostname;
            const isIP = /^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/.test(currentHost);
            const serverIPs = ['47.84.202.74'];
            const allowedDomains = ['exqstudio.cn', 'www.exqstudio.cn', 'exq-studio.github.io'];
            const localHosts = ['localhost', '127.0.0.1', '::1', ''];
            
            const ipCheckDiv = document.getElementById('ipCheck');
            const ipCheckResult = document.getElementById('ipCheckResult');
            const accessDiv = document.getElementById('accessStatus');
            const accessResult = document.getElementById('accessResult');

            // IP类型检查
            if (serverIPs.includes(currentHost)) {
                ipCheckDiv.className = 'status error';
                ipCheckResult.innerHTML = `❌ 检测到服务器IP: ${currentHost}<br>此IP应被拦截并重定向到域名`;
            } else if (localHosts.includes(currentHost) || window.location.protocol === 'file:') {
                ipCheckDiv.className = 'status success';
                ipCheckResult.innerHTML = `✅ 本地开发环境: ${currentHost || 'file://协议'}`;
            } else if (isIP) {
                ipCheckDiv.className = 'status warning';
                ipCheckResult.innerHTML = `⚠️ 其他IP地址: ${currentHost}<br>应被拦截`;
            } else if (allowedDomains.includes(currentHost)) {
                ipCheckDiv.className = 'status success';
                ipCheckResult.innerHTML = `✅ 授权域名: ${currentHost}`;
            } else {
                ipCheckDiv.className = 'status warning';
                ipCheckResult.innerHTML = `⚠️ 未知域名: ${currentHost}`;
            }

            // 访问状态检查
            if (window.location.hostname === '47.84.202.74') {
                accessDiv.className = 'status error';
                accessResult.innerHTML = `🚫 如果您看到此页面，说明IP拦截失败！<br>服务器IP访问应该被自动重定向到 exqstudio.cn`;
            } else {
                accessDiv.className = 'status success';
                accessResult.innerHTML = `✅ 正常访问 - IP拦截器工作正常`;
            }
        }

        // 测试函数
        function testLocalHost() {
            alert('测试localhost访问：\n请在浏览器中访问 http://localhost:8000/ip-test.html');
        }

        function testServerIP() {
            if (confirm('测试服务器IP拦截：\n将尝试访问 http://47.84.202.74 \n该访问应该被拦截并重定向。是否继续？')) {
                window.open('http://47.84.202.74', '_blank');
            }
        }

        function testDevMode() {
            localStorage.setItem('dev_mode', 'true');
            alert('开发模式已启用！\n页面将重新加载以应用设置。');
            window.location.reload();
        }

        function clearDevMode() {
            localStorage.removeItem('dev_mode');
            alert('开发模式已清除！\n页面将重新加载以应用设置。');
            window.location.reload();
        }

        // 检查开发模式状态
        function checkDevMode() {
            const isDevMode = localStorage.getItem('dev_mode') === 'true';
            if (isDevMode) {
                const devIndicator = document.createElement('div');
                devIndicator.style.cssText = 'position: fixed; top: 10px; right: 10px; background: #4CAF50; color: white; padding: 10px; border-radius: 5px; z-index: 9999; font-size: 12px;';
                devIndicator.textContent = '🔧 开发模式已启用';
                document.body.appendChild(devIndicator);
            }
        }

        // 初始化
        checkIPStatus();
        checkDevMode();

        // 每5秒更新一次时间戳
        setInterval(() => {
            document.getElementById('timestamp').textContent = new Date().toLocaleString();
        }, 5000);
    </script>
</body>
</html>
